<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bulk Reviews Statistics</title>

<link  href="{{ url_for('static', filename='css/bootstrap.min.css') }}"  rel="stylesheet">
<link href="{{ url_for('static', filename='css/datepicker3.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/styles.css') }}"  rel="stylesheet">
<link href="{{ url_for('static', filename='css/bootstrap-table.css') }}" rel="stylesheet">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

<!--Icons-->
<script  src="{{ url_for('static', filename='js/lumino.glyphs.js') }}"></script>

<!--[if lt IE 9]>
<script src="js/html5shiv.js"></script>
<script src="js/respond.min.js"></script>
<![endif]-->


</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"><span>ABSA</span>Toolkit</a>
				
			</div>
							
		</div><!-- /.container-fluid -->
	</nav>
		
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
		
		<ul class="nav menu">
			<li><a href="{{ url_for('index') }}"><svg class="glyph stroked dashboard-dial"><use xlink:href="#stroked-dashboard-dial"></use></svg> Review Analyser</a></li>
      <li class="active"><a href="{{ url_for('restaurant_statistics') }}"><svg class="glyph stroked calendar"><use xlink:href="#stroked-calendar"></use></svg> Statistics</a></li>
		</ul>

	</div><!--/.sidebar-->
		
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">			
	
		
		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Aspect-Based Sentiment Analysis</h1>
      <form  action="{{ url_for('upload_file') }}" method="post" enctype = "multipart/form-data">
                <div class="form-group">
									<label>File input</label>
									<input type="file" name = "file">
								</div>
                
                <button type="submit" class="btn btn-primary"> Submit </button>
      </form>
			</div>
      <br/>    
      <span>Execution time  : {{time_exe}}</span>
		</div><!--/.row-->
	
   {% if res == "yes" %}
        
      <div class="row">
       <span>Total reviews:  {{total_reviews}}<span>
        <br/>
        <br/>
        <br/>
		<div class="mytab">
		  <button class="btn tablinks" onclick="openCity(event, 'tab1')">Aspects Summary</button>
		  <button class="btn tablinks" onclick="openCity(event, 'tab2')">Sentiments Distribution</button>
		  <button class="btn tablinks" onclick="openCity(event, 'tab3')">Reviews</button>
		</div>
	
          <div class="col-lg-12 mytabcontent" id="tab1" >
				<div class="panel panel-default">
					<div class="panel-heading">Summary of Aspects</div>
					<div class="panel-body">
                               
                      {% for index,post in category.iterrows() %}
                      {% if  post['sentiment.positive']+ post['sentiment.negative']+ post['sentiment.neutral'] >= 0.3*total_reviews%} 
                          {% if  post['sentiment.positive'] >= post['sentiment.negative'] and post['sentiment.positive'] >= post['sentiment.neutral']%}
                             <div class="col-xs-12 col-md-6 col-lg-3">
                                  <div class="panel panel-green panel-widget ">
                                    <div class="row no-padding">
                                      <div class="col-sm-3 col-lg-5 widget-left">
                                       <i class="fa fa-smile-o" style="font-size:48px;color:white"></i>
                                      </div>
                                      <div class="col-sm-9 col-lg-7 widget-right">
                                        <div class="large" style="font-size:1.3em">{{ post['category'] }}</div>
								        <div class="text-muted" style="color:green">{{((post['sentiment.positive']/(post['sentiment.positive']+post['sentiment.negative']+post['sentiment.neutral']))*100)|round|int}} % positive</div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                          {% endif %}    
                           {% if  post['sentiment.negative'] >= post['sentiment.positive'] and post['sentiment.negative'] >= post['sentiment.neutral']%}
                           <div class="col-xs-12 col-md-6 col-lg-3">
                                  <div class="panel panel-red panel-widget ">
                                    <div class="row no-padding">
                                      <div class="col-sm-3 col-lg-5 widget-left">
                                       <i class="fa fa-frown-o" style="font-size:48px;color:white"></i>
                                      </div>
                                      <div class="col-sm-9 col-lg-7 widget-right">
                                        <div class="large" style="font-size:1.3em">{{ post['category'] }}</div>
                                        <div class="text-muted" style="color:red">{{((post['sentiment.negative']/(post['sentiment.positive']+post['sentiment.negative']+post['sentiment.neutral']))*100)|round|int}} % negative</div>
                                      </div>
                                    </div>
                                  </div>
                              </div> 
                           {% endif %}
                           {% if  post['sentiment.neutral'] >= post['sentiment.negative'] and post['sentiment.neutral'] >= post['sentiment.positive']%}
                            <div class="col-xs-12 col-md-6 col-lg-3">
                                  <div class="panel panel-blue panel-widget ">
                                    <div class="row no-padding">
                                      <div class="col-sm-3 col-lg-5 widget-left">
                                         <i class="fa fa-meh-o" style="font-size:54px;color:white"></i>
                                      </div>
                                      <div class="col-sm-9 col-lg-7 widget-right">
                                        <div class="large" style="font-size:1.3em">{{ post['category'] }}</div>
                                        <div class="text-muted" style="color:blue">{{((post['sentiment.neutral']/(post['sentiment.positive']+post['sentiment.negative']+post['sentiment.neutral']))*100|round|int)}} % neutral</div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                           {% endif %}
                        {% endif %}
                    {% else %}
                      
                      {% endfor %}
                   
              </div>
              </div>
              </div>
              </div>
	{% endif %}
    {% if res == "yes" %}
    
    
    <div class="row mytabcontent" id="tab2" >
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">Aspect Category wise Distribution of Sentiments</div>
					<div class="panel-body">
					 {% if res == "yes" %}
    
						<div class="canvas-wrapper">
							<canvas class="main-chart" id="chart" height="200" width="600" ></canvas>
							<div id="legend"></div>
						</div>
					{% endif %}	
					</div>
				</div>
			</div>
		</div><!--/.row-->	
    
   
    
       <div class="row mytabcontent" id="tab3" >
              <div class="col-lg-12">
                  <div class="panel panel-default">
                    <div class="panel-heading">Review Analysis Result</div>
                    <div class="panel-body">
                    <table class="table table-hover table-bordered">
                          <thead>
                          <thead>
                              <tr>
								<th style="width: 10%">Review ID </th>
                                <th style="width: 60%">Text</th>
                                <th style="width: 30%">Aspect</th>
                              </tr>

                          </thead>
                      <tbody>
                      {% for index,post in finalsf.iterrows() %}
                          <tr>
							<td>{{ post['review_id'] }}</td>
                            <td>{{ post['text'] }}</td>
							<td>
								<table class="table table-hover table-bordered">
								<tbody>
								{% for x in post['merged'].split(';') %}
								 {% if  x.find("positive") != -1 %}
									<tr class="success">
										<td>{{x}}
										</td>
									</tr>
								{% endif %}
							    {% if  x.find("negative") != -1 %}
									<tr class="danger">
										<td>{{x}}
										</td>
									</tr>
								{% endif %}
								{% if  x.find("neutral") != -1 %}
									<tr class="info">
										<td>{{x}}
										</td>
									</tr>
								{% endif %}
								{% endfor %}
								</tbody>
								</table>
                            </td>
                           
                          </tr>
                      {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
                </div>
              </div>
 
     
    {% endif %}
    
    
   </div>

	<script src="{{ url_for('static', filename='js/jquery-1.11.1.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/easypiechart.js') }}"></script>
	<script src="{{ url_for('static', filename='js/easypiechart-data.js') }}"></script>
	<script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script>
  <script src="{{ url_for('static', filename='js/d3.v3.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/d3.layout.cloud.js') }}"></script>
  <script>
		
		var color = d3.scale.category20();
          
		!function ($) {
		    $(document).on("click","ul.nav li.parent > a > span.icon", function(){          
		        $(this).find('em:first').toggleClass("glyphicon-minus");      
		    }); 
		    $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
		}(window.jQuery);

		$(window).on('resize', function () {
		  if ($(window).width() > 768) $('#sidebar-collapse').collapse('show')
		})
		$(window).on('resize', function () {
		  if ($(window).width() <= 767) $('#sidebar-collapse').collapse('hide')
		})


      
   {% if res == "yes" %}
   console.log("result is there")
   var i, tabcontent, tablinks;
		  tabcontent = document.getElementsByClassName("mytabcontent");
		  console.log(tabcontent.length)
		  for (i = 0; i < tabcontent.length; i++) {
			console.log("setting dsply")
			tabcontent[i].style.display = "none";
		  }
   // bar chart data
   var barData = {
   labels : [{% for item in category['category'] %}
                  "{{item}}",
              {% endfor %}],
   
   datasets : [
      {
        label : 'positive',
        fillColor: "rgba(217,239,150,0.8)",
        strokeColor: "rgba(217,239,150,1)",
        pointColor: "rgba(217,239,150,1)",
        data : [{% for item in category['sentiment.positive'] %}
                      {{item}},
                    {% endfor %}]
      },
       {
        label : 'negative',
        fillColor: "rgba(255,170,170,0.8)",
        strokeColor: "rgba(255,170,170,1)",
        pointColor: "rgba(255,170,170,1)",
        data : [{% for item in category['sentiment.negative'] %}
                      {{item}},
                    {% endfor %}]
      },
       {
        label : 'neutral',
        fillColor: "rgba(151,187,205,0.2)",
        strokeColor: "rgba(151,187,205,1)",
        pointColor: "rgba(151,187,205,1)",
        data : [{% for item in category['sentiment.neutral'] %}
                      {{item}},
                    {% endfor %}]
      }
      
      ]
   }
 
   // get bar chart canvas
   var mychart = document.getElementById("chart").getContext("2d");
 
   // draw bar chart
   var bar = new Chart(mychart).Bar(barData, {
       responsive : true,
       
   });
   
   var legendHolder = document.createElement('div');
    legendHolder.innerHTML = bar.generateLegend();

    document.getElementById('legend').appendChild(legendHolder.firstChild);	

   {% endif %}
   
   function openCity(evt, cityName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("mytabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
}
   
	</script>	   
	
</html>
